@using Autotest.Mvc.Services
@using Microsoft.AspNetCore.Mvc.TagHelpers
@inject QuestionService QuestionService
@model DataBase.Entietes.User

<h1>Profile</h1>

<img alt="Profile photo" style="width: 300px; height: 300px" src="@Model.PhotoPath"/>

<h3>Name: @Model.Name</h3>
<h3>Username: @Model.Username</h3>

<a class="btn btn-primary" asp-action="LogOut">Log out</a>

<h1>TotalCorrect: @Model.Tickets.Sum(t=>t.CorrectCount) / @QuestionService.Questions.Count</h1>
<h1>TotalFinishedTickets: @Model.Tickets.Count(t=>t.IsCompleted) / @QuestionService.TicketsCount</h1>

@{
    var lastweek = Model.Tickets
        .Where(t => t.Date > DateTime.Now.AddMinutes(-2))
        .Sum(t => t.CorrectCount);
}

<h1>Last week : @lastweek</h1>

@{
    var ticket = Model.Tickets.MaxBy(t => t.Date);
}

<div class="card w3-card "  >
    <div class="card-body "  >
        <h4 class="card-title w3-card"  >Ticket @(ticket.Id + 1)</h4>
            
        @if (ticket.Answers.Count > 0)
        {
            <p class="card-text w3-card">@ticket.CorrectCount / @ticket.QuestionsCount</p>
            <p class="card-text w3-card">@ticket.Date.ToString("f")</p>
        }

        <a asp-controller="Tickets" asp-action="StartTicket" asp-route-ticketIndex="@ticket.Id" style="color:crimson">Start</a>
    </div>
</div>


<br/>

<br/>

<h1>Ticket Results</h1>

<table class="table">
    <thead>
    <tr style="color: antiquewhite" >
        <th scope="col">#</th>
        <th scope="col">Ticket Index</th>
        <th scope="col">Correct Count</th>
        <th scope="col">Question Count</th>
    </tr>
    </thead>
    <tbody>
    
    @for (int i=0; i < Model.Tickets.Count; i++)
    {
        var ticketResult = Model.Tickets[i];

        <tr style="color: antiquewhite" >
            <th scope="row">@(i+1)</th>
            <td>@ticketResult.Id</td>
            <td>@ticketResult.CorrectCount</td>
            <td>@ticketResult.QuestionsCount</td>
        </tr>
    }

    </tbody>
</table>